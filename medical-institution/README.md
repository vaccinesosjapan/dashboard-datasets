# 予防接種法に基づく医療機関からの副反応疑い報告

* [第53回厚生科学審議会予防接種・ワクチン分科会副反応検討部会](https://www.mhlw.go.jp/stf/newpage_17208.html)から報告が始まった。
* 第74回まで累計で報告されており、第75回以降からは「前回との差分」の期間に対する報告に変更されている。
* 第88回から、「同時接種」という列が追加された。

## 手作業時の注意

* `lot_no`は文字列にすること。
  * 「"lot_no":9999」というように数字として記載してしまうと、フロントエンド側が内部でエラー起こす。
  * これについてフロントエンド側でタイプチェックしてエラーが起きないようにするという処置も考えられたが、多くの項目に対してタイプチェックを実施することによるパフォーマンス低下が懸念されるためデータを修正するようにした。
  * 問題箇所の有無をチェックするには、VSCodeなどの検索ツールで正規表現をOnにして「"lot_no": [^" ]」や「"lot_no":[^" ]」を検索すればよい。

## 手順

1. 新しいPDFを`pdf-files`フォルダにダウンロードする。
1. ダウンロードしたPDFのファイル名やリンクURLなどを`reports-settings.yaml`に記入する。
1. 同じ内容を`reports-settings-all.yaml`の末尾にも追記する。
1. 以下のコマンドを実行して、PDFからCSV形式でデータ抽出する。
    * `python _1-extract-pdf-to-csv.py`
    * 先に、フォルダ `./intermediate-files./{relative_dir}` を作っておくこと。
    * 抽出結果は `./intermediate-files./{relative_dir}/{file_id}.csv` に保存される。
1. CSVを開き、ヘッダ情報を手作業で追加して`{file_id}-pre.csv`に保存する。
    * ヘッダ情報は、以下を使うと良い（データと一致しない場合は更新して使う）。
    * `No,年齢,性別,接種日,発生日,接種から発生までの日数,ワクチン名,同時接種,製造販売業者,ロット番号,症状名（PT名）,因果関係（報告医評価）,重篤度（報告医評価）,転帰日,転帰内容`
1. 以下のコマンドを実行して、CSVのデータを整形する。
    * `python _2-standardize-csv.py`
    * 抽出結果は `./intermediate-files./{relative_dir}/{file_id}-converted.csv` に保存される。
1. CSVを開き、列がおかしくなっている箇所などが無いか目視で確認し、必要に応じて手作業で修正する。
    * `VSCode`の`EditCSV`拡張や`Excel`で開いて確認するとスムーズ。
    * 修正結果は `./intermediate-files./{relative_dir}/{file_id}-manually-fixed.csv` に保存する。
1. 以下のコマンドを実行して、データの最終的な整形をしつつCSVをJSONに変換して保存する。
    * `python _3-save-to-json.py`
1. `summary-metadata.yaml` を更新する。
1. `sum-medical-institution-reports-v1.py` を実行する。

## メモ

`*.pre.csv`のヘッダに手作業で追加するヘッダ。

```csv
No,年齢,性別,接種日,ワクチン名,ロット番号,製造販売業者,同時接種,同時接種ワクチン,基礎疾患等,症状名,発生日,接種から症状発生までの日数,因果関係（報告医評価）,重篤度,転帰日,転帰内容,専門家評価PT,専門家の因果関係評価,専門家のブライトン分類レベル,専門家の意見
```
