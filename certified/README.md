# 疾病・障害認定審査会のデータまとめ

厚生労働省の[疾病・障害認定審査会](https://www.mhlw.go.jp/stf/shingi/shingi-shippei_127696_00001.html)が行なった審議結果のPDFからデータを抽出する仕組みをまとめたフォルダです。

## 抽出に関して

「疾病・障害認定審査会」のPDFではpythonの`camelot`ライブラリでは抽出が出来ない表が多数あり、そういったPDFについてはMicrosoft Officeの`WORD`や`EXCEL`を用いて一旦csvファイルへとデータを抽出して処理する。

1. PDFファイルを`WORD`で開き、表全体を選択・コピーして`EXCEL`に貼り付ける
1. 表がいくつかに分かれているため、スクロールしては新しい表を同様に`EXCEL`に貼り付ける
1. `EXCEL`のファイル保存画面で`ファイルの種類`に`CSV UTF-8(コンマ区切り) (*.csv)`を選んで保存する
    * 保存先: このファイルと同じ場所にある`intermediate-files`フォルダ
    * ファイル名: PDFファイルの拡張子以外の部分と同じ（PDFが001177107.pdfなら、CSVは`001177107.csv`にする）
1. CSVのヘッダ行を、以下の内容に変更する
    * `性別,年齢,ワクチン名,請求内容,疾病名,基礎疾患,判定,否認理由,備考`
1. `reports-settings.yaml`に抽出のための設定を記述する
1. `reports-settings-all.yaml`にも同じ抽出設定を追記する
1. 以下のコマンドをPowerShellなどで実行する

```sh
python create-certified-reports-v1.py
```

特に問題がなければ以下のように何件抽出したかを報告するログが表示されて処理が終了します。

```sh
日付「2023/12/08」のデータを抽出して 001177107.json に保存中: 163 [件] 抽出しました
```

エラーが発生した場合には、ログの内容を確認して対処しましょう。一番多いのは、`年齢`と`ワクチン名`の列がセル結合している場合などで、カンマを追加・削除して修正したりします。

### 全てのデータの抽出をやり直したい場合

抽出処理の不具合修正を行なった場合や、データの型を変更した（文字列ではなく文字列の配列に変更する等）場合などに「全てのデータの抽出処理を再度実行したい」という状況があるかと思います。

その場合は、全てのデータ抽出設定を記述した`reports-settings-all.yaml`を引数に指定して以下のようにスクリプトを実行してください。（引数がない場合には、自動的に`reports-settings.yaml`を読み込んで処理するように実装しています。）

```sh
python create-certified-reports-v1.py reports-settings-all.yaml
```

## 抽出結果からサイト用のまとめデータを作る

抽出したデータはJSON形式で`reports-data`フォルダに保存されます。これらのデータを1つに結合しつつ、集計も行ってサマリ情報を生成します。

まず、使用したPDFで一番最新のものを開いて最終ページのサマリ情報を確認します。その日付と内容を、`summary-settings.yaml`に転記します。そして以下を実行します。

```sh
python sum-certified-reports-v1.py
```

実行結果はひとつ上のフォルダ階層にある`_datasets`フォルダに`certified-reports.json`などのファイル名で保存されます。

## まとめデータから傾向を抽出したデータを作る

女性・男性・総数の3つの区分で、認定された内容の上位10個の症状を抽出したデータを作ります。

```sh
python sum-trends.py
```
